{"title":"Hexo博客 | 动态分类标签条，自动获取全站分类与标签进行展示","slug":"博客相关-Hexo博客之动态分类标签条","date":"2021-08-14T13:10:23.000Z","updated":"2021-08-14T13:10:23.000Z","comments":true,"path":"api/articles/博客相关-Hexo博客之动态分类标签条.json","excerpt":null,"covers":["https://npm.elemecdn.com/justlovesmile-img/202108142116064.png","https://npm.elemecdn.com/justlovesmile-img/202108142121159.png"],"content":"<h1 id=\"1-前言\"><a href=\"#1-前言\" class=\"headerlink\" title=\"1. 前言\"></a>1. 前言</h1><p>本文是对Heo博主写的<a href=\"https://blog.zhheo.com/p/bc61964d.html\">Butterfly魔改：动态分类条，可以根据页面变化而改变的分类列表展示方式</a>文章的补充，增加了动态标签条，并且可以自动获取全站分类和标签名称。</p>\n<h1 id=\"2-预览\"><a href=\"#2-预览\" class=\"headerlink\" title=\"2. 预览\"></a>2. 预览</h1><p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"https://npm.elemecdn.com/justlovesmile-img/202108142116064.png\" alt=\"image-20210814211626863\"></p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"https://npm.elemecdn.com/justlovesmile-img/202108142121159.png\" alt=\"image-20210814212127747\"></p>\n<h1 id=\"3-配置\"><a href=\"#3-配置\" class=\"headerlink\" title=\"3. 配置\"></a>3. 配置</h1><h2 id=\"3-1-新建PUG文件\"><a href=\"#3-1-新建PUG文件\" class=\"headerlink\" title=\"3.1 新建PUG文件\"></a>3.1 新建PUG文件</h2><p>首先是分类条，在<code>themes/butterfly/layout/includes/</code>处新建文件<code>categoryBar.pug</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#category-bar</span><br><span class=\"line\">  .category-bar-items#category-bar-items</span><br><span class=\"line\">    !=getarray_bar(&quot;category&quot;)</span><br><span class=\"line\">  a.category-bar-more(href=&quot;/categories/&quot;) 更多</span><br></pre></td></tr></table></figure>\n\n<p>其次是标签条，在<code>themes/butterfly/layout/includes/</code>处新建文件<code>tagBar.pug</code>，因为样式一样，所以没有更改id和class名称。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#category-bar</span><br><span class=\"line\">  .category-bar-items#category-bar-items</span><br><span class=\"line\">    !=getarray_bar(&quot;tag&quot;)</span><br><span class=\"line\">  a.category-bar-more(href=&quot;/tags/&quot;) 更多</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-2-新建Hexo辅助函数\"><a href=\"#3-2-新建Hexo辅助函数\" class=\"headerlink\" title=\"3.2 新建Hexo辅助函数\"></a>3.2 新建Hexo辅助函数</h2><p>在<code>theme/butterfly/scripts/helpers/</code>中创建<code>get_arrays.js</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo.extend.helper.register(<span class=\"string\">&#x27;getarray_bar&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">types</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!types) &#123;</span><br><span class=\"line\">    types = <span class=\"string\">&quot;category&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> categoriesBar = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">categories</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!categories || !categories.length) <span class=\"keyword\">return</span> <span class=\"string\">``</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> categoryArr = []</span><br><span class=\"line\">    hexo.locals.get(<span class=\"string\">&#x27;categories&#x27;</span>).map(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">category</span>) </span>&#123;</span><br><span class=\"line\">      categoryArr.push(&#123; <span class=\"attr\">name</span>: category.name, <span class=\"attr\">value</span>: category.length &#125;)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    categoryArr.sort(<span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> &#123; <span class=\"keyword\">return</span> b.value - a.value &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> strCategoriesBar = <span class=\"string\">``</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; categories.length; i++) &#123;</span><br><span class=\"line\">      strTemp=<span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">      &lt;div class=&quot;category-bar-item&quot; id=&quot;<span class=\"subst\">$&#123;categoryArr[i].name&#125;</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &lt;a href=&quot;/categories/<span class=\"subst\">$&#123;categoryArr[i].name&#125;</span>/&quot;&gt;<span class=\"subst\">$&#123;categoryArr[i].name&#125;</span>&lt;/a&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &lt;/div&gt;`</span></span><br><span class=\"line\">      strCategoriesBar+=strTemp</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> strCategoriesBar</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> tagsBar = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">tags</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!tags || !tags.length) <span class=\"keyword\">return</span> <span class=\"string\">``</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> tagArr = []</span><br><span class=\"line\">    hexo.locals.get(<span class=\"string\">&#x27;tags&#x27;</span>).map(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">tag</span>) </span>&#123;</span><br><span class=\"line\">      tagArr.push(&#123; <span class=\"attr\">name</span>: tag.name, <span class=\"attr\">value</span>: tag.length &#125;)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    tagArr.sort(<span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> &#123; <span class=\"keyword\">return</span> b.value - a.value &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> strTagsBar = <span class=\"string\">``</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; tags.length; i++) &#123;</span><br><span class=\"line\">      strTemp=<span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">      &lt;div class=&quot;category-bar-item&quot; id=&quot;<span class=\"subst\">$&#123;tagArr[i].name&#125;</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &lt;a href=&quot;/tags/<span class=\"subst\">$&#123;tagArr[i].name&#125;</span>/&quot;&gt;<span class=\"subst\">$&#123;tagArr[i].name&#125;</span>&lt;/a&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &lt;/div&gt;`</span></span><br><span class=\"line\">      strTagsBar+=strTemp</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> strTagsBar</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (types == <span class=\"string\">&quot;category&quot;</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> categoriesBar(<span class=\"built_in\">this</span>.site.categories)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (types == <span class=\"string\">&quot;tag&quot;</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> tagsBar(<span class=\"built_in\">this</span>.site.tags)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-3-引用模块\"><a href=\"#3-3-引用模块\" class=\"headerlink\" title=\"3.3 引用模块\"></a>3.3 引用模块</h2><p>在需要的位置引用该模块，例如：</p>\n<p>在分类页面引用：找到<code>theme/butterfly/layout/category.pug</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">extends includes/layout.pug</span><br><span class=\"line\"></span><br><span class=\"line\">block content</span><br><span class=\"line\">  if theme.category_ui == &#x27;index&#x27;</span><br><span class=\"line\">    include ./includes/mixins/post-ui.pug</span><br><span class=\"line\">    #recent-posts.recent-posts.category_ui   </span><br><span class=\"line\">      +postUI</span><br><span class=\"line\">      include includes/pagination.pug    </span><br><span class=\"line\">  else</span><br><span class=\"line\">    include ./includes/mixins/article-sort.pug</span><br><span class=\"line\">    #category</span><br><span class=\"line\">+      .category-in-bar</span><br><span class=\"line\">+        .category-in-bar-tips</span><br><span class=\"line\">+          i.fa-fw.fas.fa-folder-open</span><br><span class=\"line\">+        include includes/categoryBar.pug</span><br><span class=\"line\">      .article-sort-title= _p(&#x27;page.category&#x27;) + &#x27; - &#x27; + page.category</span><br><span class=\"line\">      +articleSort(page.posts)</span><br><span class=\"line\">      include includes/pagination.pug</span><br></pre></td></tr></table></figure>\n\n<p>在标签页引用：找到<code>theme/butterfly/layout/tag.pug</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">extends includes/layout.pug</span><br><span class=\"line\"></span><br><span class=\"line\">block content</span><br><span class=\"line\">  if theme.tag_ui == &#x27;index&#x27;</span><br><span class=\"line\">    include ./includes/mixins/post-ui.pug</span><br><span class=\"line\">    #recent-posts.recent-posts</span><br><span class=\"line\">      +postUI</span><br><span class=\"line\">      include includes/pagination.pug</span><br><span class=\"line\">  else</span><br><span class=\"line\">    include ./includes/mixins/article-sort.pug</span><br><span class=\"line\">    #tag</span><br><span class=\"line\">+      .category-in-bar</span><br><span class=\"line\">+        .category-in-bar-tips</span><br><span class=\"line\">+          i.fa-fw.fas.fa-tags</span><br><span class=\"line\">+        include includes/tagBar.pug</span><br><span class=\"line\">      .article-sort-title= _p(&#x27;page.tag&#x27;) + &#x27; - &#x27; + page.tag</span><br><span class=\"line\">      +articleSort(page.posts)</span><br><span class=\"line\">      include includes/pagination.pug</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4-引入js和css文件\"><a href=\"#4-引入js和css文件\" class=\"headerlink\" title=\"4. 引入js和css文件\"></a>4. 引入js和css文件</h1><p>这一部分和Heo博主的教程<a href=\"https://blog.zhheo.com/p/bc61964d.html\">Butterfly魔改：动态分类条，可以根据页面变化而改变的分类列表展示方式 | 张洪Heo (zhheo.com)</a>一致。</p>\n<p>不过如果添加了标签条，js文件需要增加一个函数</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//标签条</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">tagsBarActive</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> urlinfo = <span class=\"built_in\">window</span>.location.pathname;</span><br><span class=\"line\">  urlinfo = <span class=\"built_in\">decodeURIComponent</span>(urlinfo)</span><br><span class=\"line\">  <span class=\"comment\">//console.log(urlinfo);</span></span><br><span class=\"line\">  <span class=\"comment\">//判断是否是首页</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (urlinfo == <span class=\"string\">&#x27;/&#x27;</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">document</span>.querySelector(<span class=\"string\">&#x27;#tags-bar&#x27;</span>))&#123;</span><br><span class=\"line\">      <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&#x27;首页&#x27;</span>).classList.add(<span class=\"string\">&quot;select&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 验证是否是分类链接</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> pattern = <span class=\"regexp\">/\\/tags\\/.*?\\//</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> patbool = pattern.test(urlinfo);</span><br><span class=\"line\">    <span class=\"comment\">//console.log(patbool);</span></span><br><span class=\"line\">    <span class=\"comment\">// 获取当前的标签</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (patbool) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> valuegroup = urlinfo.split(<span class=\"string\">&quot;/&quot;</span>);</span><br><span class=\"line\">      <span class=\"comment\">//console.log(valuegroup[2]);</span></span><br><span class=\"line\">      <span class=\"comment\">// 获取当前分类</span></span><br><span class=\"line\">      <span class=\"keyword\">var</span> nowTag = valuegroup[<span class=\"number\">2</span>];</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">document</span>.querySelector(<span class=\"string\">&#x27;#category-bar&#x27;</span>))&#123;</span><br><span class=\"line\">        <span class=\"built_in\">document</span>.getElementById(nowTag).classList.add(<span class=\"string\">&quot;select&quot;</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">tagsBarActive()</span><br></pre></td></tr></table></figure>\n\n","more":"<h1 id=\"1-前言\"><a href=\"#1-前言\" class=\"headerlink\" title=\"1. 前言\"></a>1. 前言</h1><p>本文是对Heo博主写的<a href=\"https://blog.zhheo.com/p/bc61964d.html\">Butterfly魔改：动态分类条，可以根据页面变化而改变的分类列表展示方式</a>文章的补充，增加了动态标签条，并且可以自动获取全站分类和标签名称。</p>\n<h1 id=\"2-预览\"><a href=\"#2-预览\" class=\"headerlink\" title=\"2. 预览\"></a>2. 预览</h1><p><img src=\"https://npm.elemecdn.com/justlovesmile-img/202108142116064.png\" alt=\"image-20210814211626863\"></p>\n<p><img src=\"https://npm.elemecdn.com/justlovesmile-img/202108142121159.png\" alt=\"image-20210814212127747\"></p>\n<h1 id=\"3-配置\"><a href=\"#3-配置\" class=\"headerlink\" title=\"3. 配置\"></a>3. 配置</h1><h2 id=\"3-1-新建PUG文件\"><a href=\"#3-1-新建PUG文件\" class=\"headerlink\" title=\"3.1 新建PUG文件\"></a>3.1 新建PUG文件</h2><p>首先是分类条，在<code>themes/butterfly/layout/includes/</code>处新建文件<code>categoryBar.pug</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#category-bar</span><br><span class=\"line\">  .category-bar-items#category-bar-items</span><br><span class=\"line\">    !=getarray_bar(&quot;category&quot;)</span><br><span class=\"line\">  a.category-bar-more(href=&quot;/categories/&quot;) 更多</span><br></pre></td></tr></table></figure>\n\n<p>其次是标签条，在<code>themes/butterfly/layout/includes/</code>处新建文件<code>tagBar.pug</code>，因为样式一样，所以没有更改id和class名称。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#category-bar</span><br><span class=\"line\">  .category-bar-items#category-bar-items</span><br><span class=\"line\">    !=getarray_bar(&quot;tag&quot;)</span><br><span class=\"line\">  a.category-bar-more(href=&quot;/tags/&quot;) 更多</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-2-新建Hexo辅助函数\"><a href=\"#3-2-新建Hexo辅助函数\" class=\"headerlink\" title=\"3.2 新建Hexo辅助函数\"></a>3.2 新建Hexo辅助函数</h2><p>在<code>theme/butterfly/scripts/helpers/</code>中创建<code>get_arrays.js</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo.extend.helper.register(<span class=\"string\">&#x27;getarray_bar&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">types</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!types) &#123;</span><br><span class=\"line\">    types = <span class=\"string\">&quot;category&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> categoriesBar = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">categories</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!categories || !categories.length) <span class=\"keyword\">return</span> <span class=\"string\">``</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> categoryArr = []</span><br><span class=\"line\">    hexo.locals.get(<span class=\"string\">&#x27;categories&#x27;</span>).map(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">category</span>) </span>&#123;</span><br><span class=\"line\">      categoryArr.push(&#123; <span class=\"attr\">name</span>: category.name, <span class=\"attr\">value</span>: category.length &#125;)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    categoryArr.sort(<span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> &#123; <span class=\"keyword\">return</span> b.value - a.value &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> strCategoriesBar = <span class=\"string\">``</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; categories.length; i++) &#123;</span><br><span class=\"line\">      strTemp=<span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">      &lt;div class=&quot;category-bar-item&quot; id=&quot;<span class=\"subst\">$&#123;categoryArr[i].name&#125;</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &lt;a href=&quot;/categories/<span class=\"subst\">$&#123;categoryArr[i].name&#125;</span>/&quot;&gt;<span class=\"subst\">$&#123;categoryArr[i].name&#125;</span>&lt;/a&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &lt;/div&gt;`</span></span><br><span class=\"line\">      strCategoriesBar+=strTemp</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> strCategoriesBar</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> tagsBar = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">tags</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!tags || !tags.length) <span class=\"keyword\">return</span> <span class=\"string\">``</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> tagArr = []</span><br><span class=\"line\">    hexo.locals.get(<span class=\"string\">&#x27;tags&#x27;</span>).map(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">tag</span>) </span>&#123;</span><br><span class=\"line\">      tagArr.push(&#123; <span class=\"attr\">name</span>: tag.name, <span class=\"attr\">value</span>: tag.length &#125;)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    tagArr.sort(<span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> &#123; <span class=\"keyword\">return</span> b.value - a.value &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> strTagsBar = <span class=\"string\">``</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; tags.length; i++) &#123;</span><br><span class=\"line\">      strTemp=<span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">      &lt;div class=&quot;category-bar-item&quot; id=&quot;<span class=\"subst\">$&#123;tagArr[i].name&#125;</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &lt;a href=&quot;/tags/<span class=\"subst\">$&#123;tagArr[i].name&#125;</span>/&quot;&gt;<span class=\"subst\">$&#123;tagArr[i].name&#125;</span>&lt;/a&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &lt;/div&gt;`</span></span><br><span class=\"line\">      strTagsBar+=strTemp</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> strTagsBar</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (types == <span class=\"string\">&quot;category&quot;</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> categoriesBar(<span class=\"built_in\">this</span>.site.categories)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (types == <span class=\"string\">&quot;tag&quot;</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> tagsBar(<span class=\"built_in\">this</span>.site.tags)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-3-引用模块\"><a href=\"#3-3-引用模块\" class=\"headerlink\" title=\"3.3 引用模块\"></a>3.3 引用模块</h2><p>在需要的位置引用该模块，例如：</p>\n<p>在分类页面引用：找到<code>theme/butterfly/layout/category.pug</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">extends includes/layout.pug</span><br><span class=\"line\"></span><br><span class=\"line\">block content</span><br><span class=\"line\">  if theme.category_ui == &#x27;index&#x27;</span><br><span class=\"line\">    include ./includes/mixins/post-ui.pug</span><br><span class=\"line\">    #recent-posts.recent-posts.category_ui   </span><br><span class=\"line\">      +postUI</span><br><span class=\"line\">      include includes/pagination.pug    </span><br><span class=\"line\">  else</span><br><span class=\"line\">    include ./includes/mixins/article-sort.pug</span><br><span class=\"line\">    #category</span><br><span class=\"line\">+      .category-in-bar</span><br><span class=\"line\">+        .category-in-bar-tips</span><br><span class=\"line\">+          i.fa-fw.fas.fa-folder-open</span><br><span class=\"line\">+        include includes/categoryBar.pug</span><br><span class=\"line\">      .article-sort-title= _p(&#x27;page.category&#x27;) + &#x27; - &#x27; + page.category</span><br><span class=\"line\">      +articleSort(page.posts)</span><br><span class=\"line\">      include includes/pagination.pug</span><br></pre></td></tr></table></figure>\n\n<p>在标签页引用：找到<code>theme/butterfly/layout/tag.pug</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">extends includes/layout.pug</span><br><span class=\"line\"></span><br><span class=\"line\">block content</span><br><span class=\"line\">  if theme.tag_ui == &#x27;index&#x27;</span><br><span class=\"line\">    include ./includes/mixins/post-ui.pug</span><br><span class=\"line\">    #recent-posts.recent-posts</span><br><span class=\"line\">      +postUI</span><br><span class=\"line\">      include includes/pagination.pug</span><br><span class=\"line\">  else</span><br><span class=\"line\">    include ./includes/mixins/article-sort.pug</span><br><span class=\"line\">    #tag</span><br><span class=\"line\">+      .category-in-bar</span><br><span class=\"line\">+        .category-in-bar-tips</span><br><span class=\"line\">+          i.fa-fw.fas.fa-tags</span><br><span class=\"line\">+        include includes/tagBar.pug</span><br><span class=\"line\">      .article-sort-title= _p(&#x27;page.tag&#x27;) + &#x27; - &#x27; + page.tag</span><br><span class=\"line\">      +articleSort(page.posts)</span><br><span class=\"line\">      include includes/pagination.pug</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4-引入js和css文件\"><a href=\"#4-引入js和css文件\" class=\"headerlink\" title=\"4. 引入js和css文件\"></a>4. 引入js和css文件</h1><p>这一部分和Heo博主的教程<a href=\"https://blog.zhheo.com/p/bc61964d.html\">Butterfly魔改：动态分类条，可以根据页面变化而改变的分类列表展示方式 | 张洪Heo (zhheo.com)</a>一致。</p>\n<p>不过如果添加了标签条，js文件需要增加一个函数</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//标签条</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">tagsBarActive</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> urlinfo = <span class=\"built_in\">window</span>.location.pathname;</span><br><span class=\"line\">  urlinfo = <span class=\"built_in\">decodeURIComponent</span>(urlinfo)</span><br><span class=\"line\">  <span class=\"comment\">//console.log(urlinfo);</span></span><br><span class=\"line\">  <span class=\"comment\">//判断是否是首页</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (urlinfo == <span class=\"string\">&#x27;/&#x27;</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">document</span>.querySelector(<span class=\"string\">&#x27;#tags-bar&#x27;</span>))&#123;</span><br><span class=\"line\">      <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&#x27;首页&#x27;</span>).classList.add(<span class=\"string\">&quot;select&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 验证是否是分类链接</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> pattern = <span class=\"regexp\">/\\/tags\\/.*?\\//</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> patbool = pattern.test(urlinfo);</span><br><span class=\"line\">    <span class=\"comment\">//console.log(patbool);</span></span><br><span class=\"line\">    <span class=\"comment\">// 获取当前的标签</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (patbool) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> valuegroup = urlinfo.split(<span class=\"string\">&quot;/&quot;</span>);</span><br><span class=\"line\">      <span class=\"comment\">//console.log(valuegroup[2]);</span></span><br><span class=\"line\">      <span class=\"comment\">// 获取当前分类</span></span><br><span class=\"line\">      <span class=\"keyword\">var</span> nowTag = valuegroup[<span class=\"number\">2</span>];</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">document</span>.querySelector(<span class=\"string\">&#x27;#category-bar&#x27;</span>))&#123;</span><br><span class=\"line\">        <span class=\"built_in\">document</span>.getElementById(nowTag).classList.add(<span class=\"string\">&quot;select&quot;</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">tagsBarActive()</span><br></pre></td></tr></table></figure>\n\n","categories":[{"name":"博客相关","path":"api/categories/博客相关.json"}],"tags":[{"name":"前端","path":"api/tags/前端.json"},{"name":"Hexo","path":"api/tags/Hexo.json"},{"name":"JS","path":"api/tags/JS.json"}]}