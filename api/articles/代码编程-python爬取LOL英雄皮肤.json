{"title":"Python爬虫 | 如何快速获取LOL英雄皮肤高清图片","slug":"代码编程-python爬取LOL英雄皮肤","date":"2019-11-07T12:31:11.000Z","updated":"2019-11-07T12:31:11.000Z","comments":true,"path":"api/articles/代码编程-python爬取LOL英雄皮肤.json","excerpt":"编写爬虫获取英雄联盟所有英雄的全部皮肤<br> [Figure] ","covers":["https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/image/lol2019.jpg","https://cdn.jsdelivr.net/gh/Justlovesmile/CDN2/post/20200722173251.png"],"content":"<ul>\n<li>编写爬虫获取英雄联盟所有英雄的全部皮肤<br><img src=\"https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/image/lol2019.jpg\"><span id=\"more\"></span></li>\n</ul>\n<blockquote>\n<ul>\n<li>需要库：<ul>\n<li>requests</li>\n<li>re</li>\n<li>json</li>\n<li>os</li>\n</ul>\n</li>\n</ul>\n</blockquote>\n<ul>\n<li>效果：在该代码文件目录下生成n个Hero文件夹保存皮肤图片。<br><img src=\"https://cdn.jsdelivr.net/gh/Justlovesmile/CDN2/post/20200722173251.png\"></li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">Date: 2019.11.7</span></span><br><span class=\"line\"><span class=\"string\">Author: Justlovesmile</span></span><br><span class=\"line\"><span class=\"string\">Language: python3</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getHtml</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        r=requests.get(url)</span><br><span class=\"line\">        r.raise_for_status()</span><br><span class=\"line\">        r.encoding=r.apparent_encoding</span><br><span class=\"line\">    <span class=\"keyword\">except</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(url+<span class=\"string\">&quot;爬取失败！&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        response = r.text</span><br><span class=\"line\">        getInfo(response)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getInfo</span>(<span class=\"params\">res</span>):</span></span><br><span class=\"line\">    lists=re.findall(<span class=\"string\">r&#x27;&quot;keys&quot;:(.*?),&quot;data&quot;&#x27;</span>,res)</span><br><span class=\"line\">    <span class=\"comment\">#print(lists)</span></span><br><span class=\"line\">    hero_id=json.loads(lists[<span class=\"number\">0</span>])</span><br><span class=\"line\">    <span class=\"comment\">#print(hero_id)</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> hero <span class=\"keyword\">in</span> hero_id.values():</span><br><span class=\"line\">        getSkin(hero)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getSkin</span>(<span class=\"params\">hero</span>):</span></span><br><span class=\"line\">    url=<span class=\"string\">&#x27;https://lol.qq.com/biz/hero/&#x27;</span>+hero+<span class=\"string\">&#x27;.js&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        r=requests.get(url)</span><br><span class=\"line\">        r.raise_for_status()</span><br><span class=\"line\">        r.encoding=r.apparent_encoding</span><br><span class=\"line\">    <span class=\"keyword\">except</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(url+<span class=\"string\">&quot;爬取失败！&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        html=r.text</span><br><span class=\"line\">        num=re.findall(<span class=\"string\">r&#x27;&quot;id&quot;:&quot;(\\d&#123;4,6&#125;)&quot;,&quot;num&quot;&#x27;</span>,html)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(num)):</span><br><span class=\"line\">            img_url=<span class=\"string\">&#x27;https://game.gtimg.cn/images/lol/act/img/skin/big&#x27;</span> + num[i] + <span class=\"string\">&#x27;.jpg&#x27;</span></span><br><span class=\"line\">            save_img(hero,img_url)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">save_img</span>(<span class=\"params\">hero,img_url</span>):</span></span><br><span class=\"line\">    root=hero+<span class=\"string\">&quot;\\\\&quot;</span></span><br><span class=\"line\">    path=root+img_url.split(<span class=\"string\">&#x27;/&#x27;</span>)[-<span class=\"number\">1</span>]</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> os.path.exists(root):</span><br><span class=\"line\">            os.mkdir(root)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> os.path.exists(path):</span><br><span class=\"line\">            r=requests.get(img_url)</span><br><span class=\"line\">            <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(path,<span class=\"string\">&#x27;wb&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">                f.write(r.content)</span><br><span class=\"line\">                f.close()</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&quot;文件保存成功！&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">&quot;文件已存在！&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">except</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;爬取失败！&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(img_url+<span class=\"string\">&quot;已下载&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    url=<span class=\"string\">&quot;https://lol.qq.com/biz/hero/champion.js&quot;</span></span><br><span class=\"line\">    getHtml(url)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure>","more":"</li>\n</ul>\n<blockquote>\n<ul>\n<li>需要库：<ul>\n<li>requests</li>\n<li>re</li>\n<li>json</li>\n<li>os</li>\n</ul>\n</li>\n</ul>\n</blockquote>\n<ul>\n<li>效果：在该代码文件目录下生成n个Hero文件夹保存皮肤图片。<br><img src=\"https://cdn.jsdelivr.net/gh/Justlovesmile/CDN2/post/20200722173251.png\"></li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">Date: 2019.11.7</span></span><br><span class=\"line\"><span class=\"string\">Author: Justlovesmile</span></span><br><span class=\"line\"><span class=\"string\">Language: python3</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getHtml</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        r=requests.get(url)</span><br><span class=\"line\">        r.raise_for_status()</span><br><span class=\"line\">        r.encoding=r.apparent_encoding</span><br><span class=\"line\">    <span class=\"keyword\">except</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(url+<span class=\"string\">&quot;爬取失败！&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        response = r.text</span><br><span class=\"line\">        getInfo(response)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getInfo</span>(<span class=\"params\">res</span>):</span></span><br><span class=\"line\">    lists=re.findall(<span class=\"string\">r&#x27;&quot;keys&quot;:(.*?),&quot;data&quot;&#x27;</span>,res)</span><br><span class=\"line\">    <span class=\"comment\">#print(lists)</span></span><br><span class=\"line\">    hero_id=json.loads(lists[<span class=\"number\">0</span>])</span><br><span class=\"line\">    <span class=\"comment\">#print(hero_id)</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> hero <span class=\"keyword\">in</span> hero_id.values():</span><br><span class=\"line\">        getSkin(hero)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getSkin</span>(<span class=\"params\">hero</span>):</span></span><br><span class=\"line\">    url=<span class=\"string\">&#x27;https://lol.qq.com/biz/hero/&#x27;</span>+hero+<span class=\"string\">&#x27;.js&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        r=requests.get(url)</span><br><span class=\"line\">        r.raise_for_status()</span><br><span class=\"line\">        r.encoding=r.apparent_encoding</span><br><span class=\"line\">    <span class=\"keyword\">except</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(url+<span class=\"string\">&quot;爬取失败！&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        html=r.text</span><br><span class=\"line\">        num=re.findall(<span class=\"string\">r&#x27;&quot;id&quot;:&quot;(\\d&#123;4,6&#125;)&quot;,&quot;num&quot;&#x27;</span>,html)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(num)):</span><br><span class=\"line\">            img_url=<span class=\"string\">&#x27;https://game.gtimg.cn/images/lol/act/img/skin/big&#x27;</span> + num[i] + <span class=\"string\">&#x27;.jpg&#x27;</span></span><br><span class=\"line\">            save_img(hero,img_url)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">save_img</span>(<span class=\"params\">hero,img_url</span>):</span></span><br><span class=\"line\">    root=hero+<span class=\"string\">&quot;\\\\&quot;</span></span><br><span class=\"line\">    path=root+img_url.split(<span class=\"string\">&#x27;/&#x27;</span>)[-<span class=\"number\">1</span>]</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> os.path.exists(root):</span><br><span class=\"line\">            os.mkdir(root)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> os.path.exists(path):</span><br><span class=\"line\">            r=requests.get(img_url)</span><br><span class=\"line\">            <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(path,<span class=\"string\">&#x27;wb&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">                f.write(r.content)</span><br><span class=\"line\">                f.close()</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&quot;文件保存成功！&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">&quot;文件已存在！&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">except</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;爬取失败！&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(img_url+<span class=\"string\">&quot;已下载&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    url=<span class=\"string\">&quot;https://lol.qq.com/biz/hero/champion.js&quot;</span></span><br><span class=\"line\">    getHtml(url)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure>","categories":[{"name":"代码编程","path":"api/categories/代码编程.json"}],"tags":[{"name":"Python","path":"api/tags/Python.json"},{"name":"爬虫","path":"api/tags/爬虫.json"}]}