{"title":"Python爬虫 | 如何获取网易云音乐评论","slug":"代码编程-如何获取网易云音乐评论","date":"2020-03-18T03:33:16.000Z","updated":"2020-03-18T03:33:16.000Z","comments":true,"path":"api/articles/代码编程-如何获取网易云音乐评论.json","excerpt":"今天看了知乎上的一个问答，关于如何爬取网易云音乐的评论","covers":["https://s1.ax1x.com/2020/03/15/88uadI.png","https://s1.ax1x.com/2020/03/15/88l2cT.png"],"content":"<p>今天看了知乎上的一个问答，关于如何爬取网易云音乐的评论</p>\n<span id=\"more\"></span>\n<p><a href=\"https://www.zhihu.com/question/36081767\">关于如何爬网易云音乐的评论</a><br>我发现，第一位大佬写的方法，嗯，确实看不懂（虽然不妨碍白嫖），然后我自己试了试，params和encSecKey直接F12+ctrlC/V复制的😂</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">不按照大佬写的加密方法，只能获取第一页的评论/(ㄒoㄒ)/~~</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">from</span> bs4 <span class=\"keyword\">import</span> BeautifulSoup</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_song_html</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;获取网页HTML&quot;&quot;&quot;</span></span><br><span class=\"line\">        headers=&#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;User-Agent&quot;</span>:<span class=\"string\">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;Host&quot;</span>:<span class=\"string\">&quot;music.163.com&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;Upgrade-Insecure-Requests&quot;</span>:<span class=\"string\">&#x27;1&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        data=&#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;params&quot;</span>: <span class=\"string\">&quot;wFDYU3SUWyoCUekCRy6S6oPwnDHv/2Cvd8zMLZ1TCZexhtvcOGdiZdCw+UC7Y5QKC+7KdMMOZqc2eHjTDFfqVEPwuajKbFwywKKBuxe2gfkYBTNiC02rbZM5OxMM22qhVrZRPZMzAxWZz3t213Ts8A==&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;encSecKey&quot;</span>: <span class=\"string\">&quot;b6c67b2c848ef79a5cc0bc0261b6b88b75209276f9f1050091d64731398809b2e0d03081618d9c1a3d442ae1367e7e1a1f54224a6e94fed8eddc3bb337017d0b9f3bb8a274fbf58e8142020b7cbd909f9addf68c674f0232811fa18bf7a1dd90030a5f607ff2c488f20e2aab37dbab1bedff5cfa6684f6e49b69bfc727e943c1&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        song_id=url.split(<span class=\"string\">&quot;=&quot;</span>)[<span class=\"number\">1</span>]</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;已知的网易云音乐网页链接&quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"comment\">#歌曲</span></span><br><span class=\"line\">        url_so=<span class=\"string\">&quot;http://music.163.com/weapi/v1/resource/comments/R_SO_4_&#123;&#125;?csrf_token=&quot;</span>.<span class=\"built_in\">format</span>(song_id)</span><br><span class=\"line\">        <span class=\"comment\">#专辑</span></span><br><span class=\"line\">        url_al=<span class=\"string\">&quot;https://music.163.com/weapi/v1/resource/comments/R_AL_3_&#123;&#125;?csrf_token=&quot;</span>.<span class=\"built_in\">format</span>(song_id)</span><br><span class=\"line\">        <span class=\"comment\">#电台</span></span><br><span class=\"line\">        url_dj=<span class=\"string\">&quot;https://music.163.com/weapi/v1/resource/comments/A_DJ_1_&#123;&#125;?csrf_token=&quot;</span>.<span class=\"built_in\">format</span>(song_id)</span><br><span class=\"line\">        urls=[url_so,url_al,url_dj]<span class=\"comment\">#常用三个url</span></span><br><span class=\"line\">        answer=<span class=\"built_in\">input</span>(<span class=\"string\">&quot;获取热门评论：1\\n获取全部评论：2\\n请输入： &quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> answer==<span class=\"string\">&#x27;1&#x27;</span>:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> url <span class=\"keyword\">in</span> urls:</span><br><span class=\"line\">                        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                                html=requests.post(url,headers=headers,data=data)</span><br><span class=\"line\">                                html.raise_for_status()</span><br><span class=\"line\">                        <span class=\"keyword\">except</span>:</span><br><span class=\"line\">                                <span class=\"keyword\">return</span> <span class=\"string\">&quot;爬取失败！&quot;</span></span><br><span class=\"line\">                        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                                get_song_hot_comments(html)</span><br><span class=\"line\">        <span class=\"keyword\">elif</span> answer==<span class=\"string\">&#x27;2&#x27;</span>:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> url <span class=\"keyword\">in</span> urls:</span><br><span class=\"line\">                        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                                html=requests.post(url,headers=headers,data=data)</span><br><span class=\"line\">                                html.raise_for_status()</span><br><span class=\"line\">                        <span class=\"keyword\">except</span>:</span><br><span class=\"line\">                                <span class=\"keyword\">return</span> <span class=\"string\">&quot;爬取失败！&quot;</span></span><br><span class=\"line\">                        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                                get_song_comments(html)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&quot;输入错误！&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_song_hot_comments</span>(<span class=\"params\">html</span>):</span></span><br><span class=\"line\">        comments = json.loads(html.text)</span><br><span class=\"line\">        hot_comments = comments[<span class=\"string\">&#x27;hotComments&#x27;</span>]</span><br><span class=\"line\">        <span class=\"keyword\">if</span> hot_comments:</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;网易云音乐热门评论.txt&#x27;</span>,<span class=\"string\">&#x27;w&#x27;</span>,encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">                                <span class=\"keyword\">for</span> C_list <span class=\"keyword\">in</span> hot_comments:</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;User: &quot;</span>+C_list[<span class=\"string\">&#x27;user&#x27;</span>][<span class=\"string\">&#x27;nickname&#x27;</span>]+<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;Comment: \\n&quot;</span>+C_list[<span class=\"string\">&#x27;content&#x27;</span>]+<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;\\n&quot;</span>+<span class=\"string\">&quot;-&quot;</span>*<span class=\"number\">30</span>+<span class=\"string\">&quot;\\n\\n&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">except</span>:</span><br><span class=\"line\">                        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;保存热门评论失败！&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;保存热门评论成功！&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_song_comments</span>(<span class=\"params\">html</span>):</span></span><br><span class=\"line\">        comments = json.loads(html.text)</span><br><span class=\"line\">        comments = comments[<span class=\"string\">&#x27;comments&#x27;</span>]</span><br><span class=\"line\">        <span class=\"keyword\">if</span> comments:</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;网易云音乐评论.txt&#x27;</span>,<span class=\"string\">&#x27;w&#x27;</span>,encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">                                <span class=\"keyword\">for</span> C_list <span class=\"keyword\">in</span> comments:</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;User: &quot;</span>+C_list[<span class=\"string\">&#x27;user&#x27;</span>][<span class=\"string\">&#x27;nickname&#x27;</span>]+<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;Comment: \\n&quot;</span>+C_list[<span class=\"string\">&#x27;content&#x27;</span>]+<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;\\n&quot;</span>+<span class=\"string\">&quot;-&quot;</span>*<span class=\"number\">30</span>+<span class=\"string\">&quot;\\n\\n&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">except</span>:</span><br><span class=\"line\">                        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;保存全部评论失败！&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;保存全部评论成功！&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">        url=<span class=\"built_in\">input</span>(<span class=\"string\">&quot;请输入需要获取的音乐网址（仅网易云音乐）: &quot;</span>)</span><br><span class=\"line\">        get_song_html(url)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">        main()</span><br></pre></td></tr></table></figure>\n\n<p>这样好像也可以获取评论，但是只有第一页的评论<br><img src=\"https://s1.ax1x.com/2020/03/15/88uadI.png\" alt=\"88uadI.png\"></p>\n<p>之后又看了第二个的评论，发现有没有加密的api<br>，于是在尝试了多个各种评论后发现👇：</p>\n<h1 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#单曲&#123;id&#125;&#123;limit&#125;&#123;offset&#125;</span></span><br><span class=\"line\">url_so=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/R_SO_4_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#专辑</span></span><br><span class=\"line\">url_al=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/R_AL_3_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#电台</span></span><br><span class=\"line\">url_dj=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/A_DJ_1_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#视频</span></span><br><span class=\"line\">url_vi=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/R_VI_62_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#MV</span></span><br><span class=\"line\">url_mv=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/R_MV_5_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#歌单</span></span><br><span class=\"line\">url_pl<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/A_PL_0_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#事件（这个好像比较特殊，有id和uid）</span></span><br><span class=\"line\">url_ev=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/A_EV_2_&#123;&#125;_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br></pre></td></tr></table></figure>\n<p>这些url对应都是评论，limit是一页的数量，offset就是偏移量=（评论页数-1） * limit<br><img src=\"https://s1.ax1x.com/2020/03/15/88l2cT.png\" alt=\"88l2cT.png\"></p>\n<p>如何爬网易云音乐的评论数？ - 知乎<br><a href=\"https://www.zhihu.com/question/36081767\">https://www.zhihu.com/question/36081767</a></p>\n","more":"<p><a href=\"https://www.zhihu.com/question/36081767\">关于如何爬网易云音乐的评论</a><br>我发现，第一位大佬写的方法，嗯，确实看不懂（虽然不妨碍白嫖），然后我自己试了试，params和encSecKey直接F12+ctrlC/V复制的😂</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">不按照大佬写的加密方法，只能获取第一页的评论/(ㄒoㄒ)/~~</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">from</span> bs4 <span class=\"keyword\">import</span> BeautifulSoup</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_song_html</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;获取网页HTML&quot;&quot;&quot;</span></span><br><span class=\"line\">        headers=&#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;User-Agent&quot;</span>:<span class=\"string\">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;Host&quot;</span>:<span class=\"string\">&quot;music.163.com&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;Upgrade-Insecure-Requests&quot;</span>:<span class=\"string\">&#x27;1&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        data=&#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;params&quot;</span>: <span class=\"string\">&quot;wFDYU3SUWyoCUekCRy6S6oPwnDHv/2Cvd8zMLZ1TCZexhtvcOGdiZdCw+UC7Y5QKC+7KdMMOZqc2eHjTDFfqVEPwuajKbFwywKKBuxe2gfkYBTNiC02rbZM5OxMM22qhVrZRPZMzAxWZz3t213Ts8A==&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;encSecKey&quot;</span>: <span class=\"string\">&quot;b6c67b2c848ef79a5cc0bc0261b6b88b75209276f9f1050091d64731398809b2e0d03081618d9c1a3d442ae1367e7e1a1f54224a6e94fed8eddc3bb337017d0b9f3bb8a274fbf58e8142020b7cbd909f9addf68c674f0232811fa18bf7a1dd90030a5f607ff2c488f20e2aab37dbab1bedff5cfa6684f6e49b69bfc727e943c1&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        song_id=url.split(<span class=\"string\">&quot;=&quot;</span>)[<span class=\"number\">1</span>]</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;已知的网易云音乐网页链接&quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"comment\">#歌曲</span></span><br><span class=\"line\">        url_so=<span class=\"string\">&quot;http://music.163.com/weapi/v1/resource/comments/R_SO_4_&#123;&#125;?csrf_token=&quot;</span>.<span class=\"built_in\">format</span>(song_id)</span><br><span class=\"line\">        <span class=\"comment\">#专辑</span></span><br><span class=\"line\">        url_al=<span class=\"string\">&quot;https://music.163.com/weapi/v1/resource/comments/R_AL_3_&#123;&#125;?csrf_token=&quot;</span>.<span class=\"built_in\">format</span>(song_id)</span><br><span class=\"line\">        <span class=\"comment\">#电台</span></span><br><span class=\"line\">        url_dj=<span class=\"string\">&quot;https://music.163.com/weapi/v1/resource/comments/A_DJ_1_&#123;&#125;?csrf_token=&quot;</span>.<span class=\"built_in\">format</span>(song_id)</span><br><span class=\"line\">        urls=[url_so,url_al,url_dj]<span class=\"comment\">#常用三个url</span></span><br><span class=\"line\">        answer=<span class=\"built_in\">input</span>(<span class=\"string\">&quot;获取热门评论：1\\n获取全部评论：2\\n请输入： &quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> answer==<span class=\"string\">&#x27;1&#x27;</span>:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> url <span class=\"keyword\">in</span> urls:</span><br><span class=\"line\">                        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                                html=requests.post(url,headers=headers,data=data)</span><br><span class=\"line\">                                html.raise_for_status()</span><br><span class=\"line\">                        <span class=\"keyword\">except</span>:</span><br><span class=\"line\">                                <span class=\"keyword\">return</span> <span class=\"string\">&quot;爬取失败！&quot;</span></span><br><span class=\"line\">                        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                                get_song_hot_comments(html)</span><br><span class=\"line\">        <span class=\"keyword\">elif</span> answer==<span class=\"string\">&#x27;2&#x27;</span>:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> url <span class=\"keyword\">in</span> urls:</span><br><span class=\"line\">                        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                                html=requests.post(url,headers=headers,data=data)</span><br><span class=\"line\">                                html.raise_for_status()</span><br><span class=\"line\">                        <span class=\"keyword\">except</span>:</span><br><span class=\"line\">                                <span class=\"keyword\">return</span> <span class=\"string\">&quot;爬取失败！&quot;</span></span><br><span class=\"line\">                        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                                get_song_comments(html)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&quot;输入错误！&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_song_hot_comments</span>(<span class=\"params\">html</span>):</span></span><br><span class=\"line\">        comments = json.loads(html.text)</span><br><span class=\"line\">        hot_comments = comments[<span class=\"string\">&#x27;hotComments&#x27;</span>]</span><br><span class=\"line\">        <span class=\"keyword\">if</span> hot_comments:</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;网易云音乐热门评论.txt&#x27;</span>,<span class=\"string\">&#x27;w&#x27;</span>,encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">                                <span class=\"keyword\">for</span> C_list <span class=\"keyword\">in</span> hot_comments:</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;User: &quot;</span>+C_list[<span class=\"string\">&#x27;user&#x27;</span>][<span class=\"string\">&#x27;nickname&#x27;</span>]+<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;Comment: \\n&quot;</span>+C_list[<span class=\"string\">&#x27;content&#x27;</span>]+<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;\\n&quot;</span>+<span class=\"string\">&quot;-&quot;</span>*<span class=\"number\">30</span>+<span class=\"string\">&quot;\\n\\n&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">except</span>:</span><br><span class=\"line\">                        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;保存热门评论失败！&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;保存热门评论成功！&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_song_comments</span>(<span class=\"params\">html</span>):</span></span><br><span class=\"line\">        comments = json.loads(html.text)</span><br><span class=\"line\">        comments = comments[<span class=\"string\">&#x27;comments&#x27;</span>]</span><br><span class=\"line\">        <span class=\"keyword\">if</span> comments:</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;网易云音乐评论.txt&#x27;</span>,<span class=\"string\">&#x27;w&#x27;</span>,encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">                                <span class=\"keyword\">for</span> C_list <span class=\"keyword\">in</span> comments:</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;User: &quot;</span>+C_list[<span class=\"string\">&#x27;user&#x27;</span>][<span class=\"string\">&#x27;nickname&#x27;</span>]+<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;Comment: \\n&quot;</span>+C_list[<span class=\"string\">&#x27;content&#x27;</span>]+<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;\\n&quot;</span>+<span class=\"string\">&quot;-&quot;</span>*<span class=\"number\">30</span>+<span class=\"string\">&quot;\\n\\n&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">except</span>:</span><br><span class=\"line\">                        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;保存全部评论失败！&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;保存全部评论成功！&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">        url=<span class=\"built_in\">input</span>(<span class=\"string\">&quot;请输入需要获取的音乐网址（仅网易云音乐）: &quot;</span>)</span><br><span class=\"line\">        get_song_html(url)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">        main()</span><br></pre></td></tr></table></figure>\n\n<p>这样好像也可以获取评论，但是只有第一页的评论<br><img src=\"https://s1.ax1x.com/2020/03/15/88uadI.png\" alt=\"88uadI.png\"></p>\n<p>之后又看了第二个的评论，发现有没有加密的api<br>，于是在尝试了多个各种评论后发现👇：</p>\n<h1 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#单曲&#123;id&#125;&#123;limit&#125;&#123;offset&#125;</span></span><br><span class=\"line\">url_so=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/R_SO_4_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#专辑</span></span><br><span class=\"line\">url_al=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/R_AL_3_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#电台</span></span><br><span class=\"line\">url_dj=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/A_DJ_1_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#视频</span></span><br><span class=\"line\">url_vi=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/R_VI_62_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#MV</span></span><br><span class=\"line\">url_mv=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/R_MV_5_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#歌单</span></span><br><span class=\"line\">url_pl<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/A_PL_0_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#事件（这个好像比较特殊，有id和uid）</span></span><br><span class=\"line\">url_ev=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/A_EV_2_&#123;&#125;_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br></pre></td></tr></table></figure>\n<p>这些url对应都是评论，limit是一页的数量，offset就是偏移量=（评论页数-1） * limit<br><img src=\"https://s1.ax1x.com/2020/03/15/88l2cT.png\" alt=\"88l2cT.png\"></p>\n<p>如何爬网易云音乐的评论数？ - 知乎<br><a href=\"https://www.zhihu.com/question/36081767\">https://www.zhihu.com/question/36081767</a></p>","categories":[{"name":"代码编程","path":"api/categories/代码编程.json"}],"tags":[{"name":"Python","path":"api/tags/Python.json"},{"name":"爬虫","path":"api/tags/爬虫.json"}]}