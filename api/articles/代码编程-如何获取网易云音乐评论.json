{"title":"Pythonçˆ¬è™« | å¦‚ä½•è·å–ç½‘æ˜“äº‘éŸ³ä¹è¯„è®º","slug":"ä»£ç ç¼–ç¨‹-å¦‚ä½•è·å–ç½‘æ˜“äº‘éŸ³ä¹è¯„è®º","date":"2020-03-18T03:33:16.000Z","updated":"2020-03-18T03:33:16.000Z","comments":true,"path":"api/articles/ä»£ç ç¼–ç¨‹-å¦‚ä½•è·å–ç½‘æ˜“äº‘éŸ³ä¹è¯„è®º.json","excerpt":"ä»Šå¤©çœ‹äº†çŸ¥ä¹ä¸Šçš„ä¸€ä¸ªé—®ç­”ï¼Œå…³äºå¦‚ä½•çˆ¬å–ç½‘æ˜“äº‘éŸ³ä¹çš„è¯„è®º","covers":["https://s1.ax1x.com/2020/03/15/88uadI.png","https://s1.ax1x.com/2020/03/15/88l2cT.png"],"content":"<p>ä»Šå¤©çœ‹äº†çŸ¥ä¹ä¸Šçš„ä¸€ä¸ªé—®ç­”ï¼Œå…³äºå¦‚ä½•çˆ¬å–ç½‘æ˜“äº‘éŸ³ä¹çš„è¯„è®º</p>\n<span id=\"more\"></span>\n<p><a href=\"https://www.zhihu.com/question/36081767\">å…³äºå¦‚ä½•çˆ¬ç½‘æ˜“äº‘éŸ³ä¹çš„è¯„è®º</a><br>æˆ‘å‘ç°ï¼Œç¬¬ä¸€ä½å¤§ä½¬å†™çš„æ–¹æ³•ï¼Œå—¯ï¼Œç¡®å®çœ‹ä¸æ‡‚ï¼ˆè™½ç„¶ä¸å¦¨ç¢ç™½å«–ï¼‰ï¼Œç„¶åæˆ‘è‡ªå·±è¯•äº†è¯•ï¼Œparamså’ŒencSecKeyç›´æ¥F12+ctrlC/Vå¤åˆ¶çš„ğŸ˜‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">ä¸æŒ‰ç…§å¤§ä½¬å†™çš„åŠ å¯†æ–¹æ³•ï¼Œåªèƒ½è·å–ç¬¬ä¸€é¡µçš„è¯„è®º/(ã„’oã„’)/~~</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">from</span> bs4 <span class=\"keyword\">import</span> BeautifulSoup</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_song_html</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;è·å–ç½‘é¡µHTML&quot;&quot;&quot;</span></span><br><span class=\"line\">        headers=&#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;User-Agent&quot;</span>:<span class=\"string\">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;Host&quot;</span>:<span class=\"string\">&quot;music.163.com&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;Upgrade-Insecure-Requests&quot;</span>:<span class=\"string\">&#x27;1&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        data=&#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;params&quot;</span>: <span class=\"string\">&quot;wFDYU3SUWyoCUekCRy6S6oPwnDHv/2Cvd8zMLZ1TCZexhtvcOGdiZdCw+UC7Y5QKC+7KdMMOZqc2eHjTDFfqVEPwuajKbFwywKKBuxe2gfkYBTNiC02rbZM5OxMM22qhVrZRPZMzAxWZz3t213Ts8A==&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;encSecKey&quot;</span>: <span class=\"string\">&quot;b6c67b2c848ef79a5cc0bc0261b6b88b75209276f9f1050091d64731398809b2e0d03081618d9c1a3d442ae1367e7e1a1f54224a6e94fed8eddc3bb337017d0b9f3bb8a274fbf58e8142020b7cbd909f9addf68c674f0232811fa18bf7a1dd90030a5f607ff2c488f20e2aab37dbab1bedff5cfa6684f6e49b69bfc727e943c1&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        song_id=url.split(<span class=\"string\">&quot;=&quot;</span>)[<span class=\"number\">1</span>]</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;å·²çŸ¥çš„ç½‘æ˜“äº‘éŸ³ä¹ç½‘é¡µé“¾æ¥&quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"comment\">#æ­Œæ›²</span></span><br><span class=\"line\">        url_so=<span class=\"string\">&quot;http://music.163.com/weapi/v1/resource/comments/R_SO_4_&#123;&#125;?csrf_token=&quot;</span>.<span class=\"built_in\">format</span>(song_id)</span><br><span class=\"line\">        <span class=\"comment\">#ä¸“è¾‘</span></span><br><span class=\"line\">        url_al=<span class=\"string\">&quot;https://music.163.com/weapi/v1/resource/comments/R_AL_3_&#123;&#125;?csrf_token=&quot;</span>.<span class=\"built_in\">format</span>(song_id)</span><br><span class=\"line\">        <span class=\"comment\">#ç”µå°</span></span><br><span class=\"line\">        url_dj=<span class=\"string\">&quot;https://music.163.com/weapi/v1/resource/comments/A_DJ_1_&#123;&#125;?csrf_token=&quot;</span>.<span class=\"built_in\">format</span>(song_id)</span><br><span class=\"line\">        urls=[url_so,url_al,url_dj]<span class=\"comment\">#å¸¸ç”¨ä¸‰ä¸ªurl</span></span><br><span class=\"line\">        answer=<span class=\"built_in\">input</span>(<span class=\"string\">&quot;è·å–çƒ­é—¨è¯„è®ºï¼š1\\nè·å–å…¨éƒ¨è¯„è®ºï¼š2\\nè¯·è¾“å…¥ï¼š &quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> answer==<span class=\"string\">&#x27;1&#x27;</span>:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> url <span class=\"keyword\">in</span> urls:</span><br><span class=\"line\">                        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                                html=requests.post(url,headers=headers,data=data)</span><br><span class=\"line\">                                html.raise_for_status()</span><br><span class=\"line\">                        <span class=\"keyword\">except</span>:</span><br><span class=\"line\">                                <span class=\"keyword\">return</span> <span class=\"string\">&quot;çˆ¬å–å¤±è´¥ï¼&quot;</span></span><br><span class=\"line\">                        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                                get_song_hot_comments(html)</span><br><span class=\"line\">        <span class=\"keyword\">elif</span> answer==<span class=\"string\">&#x27;2&#x27;</span>:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> url <span class=\"keyword\">in</span> urls:</span><br><span class=\"line\">                        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                                html=requests.post(url,headers=headers,data=data)</span><br><span class=\"line\">                                html.raise_for_status()</span><br><span class=\"line\">                        <span class=\"keyword\">except</span>:</span><br><span class=\"line\">                                <span class=\"keyword\">return</span> <span class=\"string\">&quot;çˆ¬å–å¤±è´¥ï¼&quot;</span></span><br><span class=\"line\">                        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                                get_song_comments(html)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&quot;è¾“å…¥é”™è¯¯ï¼&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_song_hot_comments</span>(<span class=\"params\">html</span>):</span></span><br><span class=\"line\">        comments = json.loads(html.text)</span><br><span class=\"line\">        hot_comments = comments[<span class=\"string\">&#x27;hotComments&#x27;</span>]</span><br><span class=\"line\">        <span class=\"keyword\">if</span> hot_comments:</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;ç½‘æ˜“äº‘éŸ³ä¹çƒ­é—¨è¯„è®º.txt&#x27;</span>,<span class=\"string\">&#x27;w&#x27;</span>,encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">                                <span class=\"keyword\">for</span> C_list <span class=\"keyword\">in</span> hot_comments:</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;User: &quot;</span>+C_list[<span class=\"string\">&#x27;user&#x27;</span>][<span class=\"string\">&#x27;nickname&#x27;</span>]+<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;Comment: \\n&quot;</span>+C_list[<span class=\"string\">&#x27;content&#x27;</span>]+<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;\\n&quot;</span>+<span class=\"string\">&quot;-&quot;</span>*<span class=\"number\">30</span>+<span class=\"string\">&quot;\\n\\n&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">except</span>:</span><br><span class=\"line\">                        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;ä¿å­˜çƒ­é—¨è¯„è®ºå¤±è´¥ï¼&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;ä¿å­˜çƒ­é—¨è¯„è®ºæˆåŠŸï¼&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_song_comments</span>(<span class=\"params\">html</span>):</span></span><br><span class=\"line\">        comments = json.loads(html.text)</span><br><span class=\"line\">        comments = comments[<span class=\"string\">&#x27;comments&#x27;</span>]</span><br><span class=\"line\">        <span class=\"keyword\">if</span> comments:</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;ç½‘æ˜“äº‘éŸ³ä¹è¯„è®º.txt&#x27;</span>,<span class=\"string\">&#x27;w&#x27;</span>,encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">                                <span class=\"keyword\">for</span> C_list <span class=\"keyword\">in</span> comments:</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;User: &quot;</span>+C_list[<span class=\"string\">&#x27;user&#x27;</span>][<span class=\"string\">&#x27;nickname&#x27;</span>]+<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;Comment: \\n&quot;</span>+C_list[<span class=\"string\">&#x27;content&#x27;</span>]+<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;\\n&quot;</span>+<span class=\"string\">&quot;-&quot;</span>*<span class=\"number\">30</span>+<span class=\"string\">&quot;\\n\\n&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">except</span>:</span><br><span class=\"line\">                        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;ä¿å­˜å…¨éƒ¨è¯„è®ºå¤±è´¥ï¼&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;ä¿å­˜å…¨éƒ¨è¯„è®ºæˆåŠŸï¼&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">        url=<span class=\"built_in\">input</span>(<span class=\"string\">&quot;è¯·è¾“å…¥éœ€è¦è·å–çš„éŸ³ä¹ç½‘å€ï¼ˆä»…ç½‘æ˜“äº‘éŸ³ä¹ï¼‰: &quot;</span>)</span><br><span class=\"line\">        get_song_html(url)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">        main()</span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ ·å¥½åƒä¹Ÿå¯ä»¥è·å–è¯„è®ºï¼Œä½†æ˜¯åªæœ‰ç¬¬ä¸€é¡µçš„è¯„è®º<br><img src=\"https://s1.ax1x.com/2020/03/15/88uadI.png\" alt=\"88uadI.png\"></p>\n<p>ä¹‹ååˆçœ‹äº†ç¬¬äºŒä¸ªçš„è¯„è®ºï¼Œå‘ç°æœ‰æ²¡æœ‰åŠ å¯†çš„api<br>ï¼Œäºæ˜¯åœ¨å°è¯•äº†å¤šä¸ªå„ç§è¯„è®ºåå‘ç°ğŸ‘‡ï¼š</p>\n<h1 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#å•æ›²&#123;id&#125;&#123;limit&#125;&#123;offset&#125;</span></span><br><span class=\"line\">url_so=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/R_SO_4_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#ä¸“è¾‘</span></span><br><span class=\"line\">url_al=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/R_AL_3_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#ç”µå°</span></span><br><span class=\"line\">url_dj=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/A_DJ_1_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#è§†é¢‘</span></span><br><span class=\"line\">url_vi=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/R_VI_62_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#MV</span></span><br><span class=\"line\">url_mv=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/R_MV_5_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#æ­Œå•</span></span><br><span class=\"line\">url_pl<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/A_PL_0_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#äº‹ä»¶ï¼ˆè¿™ä¸ªå¥½åƒæ¯”è¾ƒç‰¹æ®Šï¼Œæœ‰idå’Œuidï¼‰</span></span><br><span class=\"line\">url_ev=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/A_EV_2_&#123;&#125;_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br></pre></td></tr></table></figure>\n<p>è¿™äº›urlå¯¹åº”éƒ½æ˜¯è¯„è®ºï¼Œlimitæ˜¯ä¸€é¡µçš„æ•°é‡ï¼Œoffsetå°±æ˜¯åç§»é‡=ï¼ˆè¯„è®ºé¡µæ•°-1ï¼‰ * limit<br><img src=\"https://s1.ax1x.com/2020/03/15/88l2cT.png\" alt=\"88l2cT.png\"></p>\n<p>å¦‚ä½•çˆ¬ç½‘æ˜“äº‘éŸ³ä¹çš„è¯„è®ºæ•°ï¼Ÿ - çŸ¥ä¹<br><a href=\"https://www.zhihu.com/question/36081767\">https://www.zhihu.com/question/36081767</a></p>\n","more":"<p><a href=\"https://www.zhihu.com/question/36081767\">å…³äºå¦‚ä½•çˆ¬ç½‘æ˜“äº‘éŸ³ä¹çš„è¯„è®º</a><br>æˆ‘å‘ç°ï¼Œç¬¬ä¸€ä½å¤§ä½¬å†™çš„æ–¹æ³•ï¼Œå—¯ï¼Œç¡®å®çœ‹ä¸æ‡‚ï¼ˆè™½ç„¶ä¸å¦¨ç¢ç™½å«–ï¼‰ï¼Œç„¶åæˆ‘è‡ªå·±è¯•äº†è¯•ï¼Œparamså’ŒencSecKeyç›´æ¥F12+ctrlC/Vå¤åˆ¶çš„ğŸ˜‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">ä¸æŒ‰ç…§å¤§ä½¬å†™çš„åŠ å¯†æ–¹æ³•ï¼Œåªèƒ½è·å–ç¬¬ä¸€é¡µçš„è¯„è®º/(ã„’oã„’)/~~</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">from</span> bs4 <span class=\"keyword\">import</span> BeautifulSoup</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_song_html</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;è·å–ç½‘é¡µHTML&quot;&quot;&quot;</span></span><br><span class=\"line\">        headers=&#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;User-Agent&quot;</span>:<span class=\"string\">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;Host&quot;</span>:<span class=\"string\">&quot;music.163.com&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;Upgrade-Insecure-Requests&quot;</span>:<span class=\"string\">&#x27;1&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        data=&#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;params&quot;</span>: <span class=\"string\">&quot;wFDYU3SUWyoCUekCRy6S6oPwnDHv/2Cvd8zMLZ1TCZexhtvcOGdiZdCw+UC7Y5QKC+7KdMMOZqc2eHjTDFfqVEPwuajKbFwywKKBuxe2gfkYBTNiC02rbZM5OxMM22qhVrZRPZMzAxWZz3t213Ts8A==&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;encSecKey&quot;</span>: <span class=\"string\">&quot;b6c67b2c848ef79a5cc0bc0261b6b88b75209276f9f1050091d64731398809b2e0d03081618d9c1a3d442ae1367e7e1a1f54224a6e94fed8eddc3bb337017d0b9f3bb8a274fbf58e8142020b7cbd909f9addf68c674f0232811fa18bf7a1dd90030a5f607ff2c488f20e2aab37dbab1bedff5cfa6684f6e49b69bfc727e943c1&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        song_id=url.split(<span class=\"string\">&quot;=&quot;</span>)[<span class=\"number\">1</span>]</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;å·²çŸ¥çš„ç½‘æ˜“äº‘éŸ³ä¹ç½‘é¡µé“¾æ¥&quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"comment\">#æ­Œæ›²</span></span><br><span class=\"line\">        url_so=<span class=\"string\">&quot;http://music.163.com/weapi/v1/resource/comments/R_SO_4_&#123;&#125;?csrf_token=&quot;</span>.<span class=\"built_in\">format</span>(song_id)</span><br><span class=\"line\">        <span class=\"comment\">#ä¸“è¾‘</span></span><br><span class=\"line\">        url_al=<span class=\"string\">&quot;https://music.163.com/weapi/v1/resource/comments/R_AL_3_&#123;&#125;?csrf_token=&quot;</span>.<span class=\"built_in\">format</span>(song_id)</span><br><span class=\"line\">        <span class=\"comment\">#ç”µå°</span></span><br><span class=\"line\">        url_dj=<span class=\"string\">&quot;https://music.163.com/weapi/v1/resource/comments/A_DJ_1_&#123;&#125;?csrf_token=&quot;</span>.<span class=\"built_in\">format</span>(song_id)</span><br><span class=\"line\">        urls=[url_so,url_al,url_dj]<span class=\"comment\">#å¸¸ç”¨ä¸‰ä¸ªurl</span></span><br><span class=\"line\">        answer=<span class=\"built_in\">input</span>(<span class=\"string\">&quot;è·å–çƒ­é—¨è¯„è®ºï¼š1\\nè·å–å…¨éƒ¨è¯„è®ºï¼š2\\nè¯·è¾“å…¥ï¼š &quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> answer==<span class=\"string\">&#x27;1&#x27;</span>:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> url <span class=\"keyword\">in</span> urls:</span><br><span class=\"line\">                        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                                html=requests.post(url,headers=headers,data=data)</span><br><span class=\"line\">                                html.raise_for_status()</span><br><span class=\"line\">                        <span class=\"keyword\">except</span>:</span><br><span class=\"line\">                                <span class=\"keyword\">return</span> <span class=\"string\">&quot;çˆ¬å–å¤±è´¥ï¼&quot;</span></span><br><span class=\"line\">                        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                                get_song_hot_comments(html)</span><br><span class=\"line\">        <span class=\"keyword\">elif</span> answer==<span class=\"string\">&#x27;2&#x27;</span>:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> url <span class=\"keyword\">in</span> urls:</span><br><span class=\"line\">                        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                                html=requests.post(url,headers=headers,data=data)</span><br><span class=\"line\">                                html.raise_for_status()</span><br><span class=\"line\">                        <span class=\"keyword\">except</span>:</span><br><span class=\"line\">                                <span class=\"keyword\">return</span> <span class=\"string\">&quot;çˆ¬å–å¤±è´¥ï¼&quot;</span></span><br><span class=\"line\">                        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                                get_song_comments(html)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&quot;è¾“å…¥é”™è¯¯ï¼&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_song_hot_comments</span>(<span class=\"params\">html</span>):</span></span><br><span class=\"line\">        comments = json.loads(html.text)</span><br><span class=\"line\">        hot_comments = comments[<span class=\"string\">&#x27;hotComments&#x27;</span>]</span><br><span class=\"line\">        <span class=\"keyword\">if</span> hot_comments:</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;ç½‘æ˜“äº‘éŸ³ä¹çƒ­é—¨è¯„è®º.txt&#x27;</span>,<span class=\"string\">&#x27;w&#x27;</span>,encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">                                <span class=\"keyword\">for</span> C_list <span class=\"keyword\">in</span> hot_comments:</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;User: &quot;</span>+C_list[<span class=\"string\">&#x27;user&#x27;</span>][<span class=\"string\">&#x27;nickname&#x27;</span>]+<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;Comment: \\n&quot;</span>+C_list[<span class=\"string\">&#x27;content&#x27;</span>]+<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;\\n&quot;</span>+<span class=\"string\">&quot;-&quot;</span>*<span class=\"number\">30</span>+<span class=\"string\">&quot;\\n\\n&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">except</span>:</span><br><span class=\"line\">                        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;ä¿å­˜çƒ­é—¨è¯„è®ºå¤±è´¥ï¼&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;ä¿å­˜çƒ­é—¨è¯„è®ºæˆåŠŸï¼&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_song_comments</span>(<span class=\"params\">html</span>):</span></span><br><span class=\"line\">        comments = json.loads(html.text)</span><br><span class=\"line\">        comments = comments[<span class=\"string\">&#x27;comments&#x27;</span>]</span><br><span class=\"line\">        <span class=\"keyword\">if</span> comments:</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;ç½‘æ˜“äº‘éŸ³ä¹è¯„è®º.txt&#x27;</span>,<span class=\"string\">&#x27;w&#x27;</span>,encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">                                <span class=\"keyword\">for</span> C_list <span class=\"keyword\">in</span> comments:</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;User: &quot;</span>+C_list[<span class=\"string\">&#x27;user&#x27;</span>][<span class=\"string\">&#x27;nickname&#x27;</span>]+<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;Comment: \\n&quot;</span>+C_list[<span class=\"string\">&#x27;content&#x27;</span>]+<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">                                        f.write(<span class=\"string\">&quot;\\n&quot;</span>+<span class=\"string\">&quot;-&quot;</span>*<span class=\"number\">30</span>+<span class=\"string\">&quot;\\n\\n&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">except</span>:</span><br><span class=\"line\">                        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;ä¿å­˜å…¨éƒ¨è¯„è®ºå¤±è´¥ï¼&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;ä¿å­˜å…¨éƒ¨è¯„è®ºæˆåŠŸï¼&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">        url=<span class=\"built_in\">input</span>(<span class=\"string\">&quot;è¯·è¾“å…¥éœ€è¦è·å–çš„éŸ³ä¹ç½‘å€ï¼ˆä»…ç½‘æ˜“äº‘éŸ³ä¹ï¼‰: &quot;</span>)</span><br><span class=\"line\">        get_song_html(url)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">        main()</span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ ·å¥½åƒä¹Ÿå¯ä»¥è·å–è¯„è®ºï¼Œä½†æ˜¯åªæœ‰ç¬¬ä¸€é¡µçš„è¯„è®º<br><img src=\"https://s1.ax1x.com/2020/03/15/88uadI.png\" alt=\"88uadI.png\"></p>\n<p>ä¹‹ååˆçœ‹äº†ç¬¬äºŒä¸ªçš„è¯„è®ºï¼Œå‘ç°æœ‰æ²¡æœ‰åŠ å¯†çš„api<br>ï¼Œäºæ˜¯åœ¨å°è¯•äº†å¤šä¸ªå„ç§è¯„è®ºåå‘ç°ğŸ‘‡ï¼š</p>\n<h1 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#å•æ›²&#123;id&#125;&#123;limit&#125;&#123;offset&#125;</span></span><br><span class=\"line\">url_so=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/R_SO_4_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#ä¸“è¾‘</span></span><br><span class=\"line\">url_al=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/R_AL_3_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#ç”µå°</span></span><br><span class=\"line\">url_dj=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/A_DJ_1_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#è§†é¢‘</span></span><br><span class=\"line\">url_vi=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/R_VI_62_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#MV</span></span><br><span class=\"line\">url_mv=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/R_MV_5_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#æ­Œå•</span></span><br><span class=\"line\">url_pl<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/A_PL_0_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#äº‹ä»¶ï¼ˆè¿™ä¸ªå¥½åƒæ¯”è¾ƒç‰¹æ®Šï¼Œæœ‰idå’Œuidï¼‰</span></span><br><span class=\"line\">url_ev=<span class=\"string\">&quot;http://music.163.com/api/v1/resource/comments/A_EV_2_&#123;&#125;_&#123;&#125;?limit=&#123;&#125;&amp;offset=&#123;&#125;&quot;</span></span><br></pre></td></tr></table></figure>\n<p>è¿™äº›urlå¯¹åº”éƒ½æ˜¯è¯„è®ºï¼Œlimitæ˜¯ä¸€é¡µçš„æ•°é‡ï¼Œoffsetå°±æ˜¯åç§»é‡=ï¼ˆè¯„è®ºé¡µæ•°-1ï¼‰ * limit<br><img src=\"https://s1.ax1x.com/2020/03/15/88l2cT.png\" alt=\"88l2cT.png\"></p>\n<p>å¦‚ä½•çˆ¬ç½‘æ˜“äº‘éŸ³ä¹çš„è¯„è®ºæ•°ï¼Ÿ - çŸ¥ä¹<br><a href=\"https://www.zhihu.com/question/36081767\">https://www.zhihu.com/question/36081767</a></p>","categories":[{"name":"ä»£ç ç¼–ç¨‹","path":"api/categories/ä»£ç ç¼–ç¨‹.json"}],"tags":[{"name":"Python","path":"api/tags/Python.json"},{"name":"çˆ¬è™«","path":"api/tags/çˆ¬è™«.json"}]}